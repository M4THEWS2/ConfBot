"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Program=void 0;var _INIParser=require("./INIParser");var _path=require("path");var _discord=require("discord.js");var _Executable=require("./Executable");function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}var configFilePath=(0,_path.join)(__dirname,"../../../natriy.cfg");var Program=function(){function Program(){_classCallCheck(this,Program);}_createClass(Program,null,[{key:"main",value:function main(){var _this=this;this.updateData();var token=this.config.getItem("token",this.settings);if(!token)throw new Error("no token found in section 'settings'.");this.bot=new _discord.Client({intents:["Guilds","GuildMessages","GuildMembers","GuildBans","MessageContent"]});this.bot.on("ready",function(){console.log("Bot is ready! - ".concat(new Date().toLocaleTimeString()));});this.bot.on("messageCreate",function(message){message.content=message.content.trimStart().trimEnd();if(!message.content.startsWith(_this.prefix)||message.author.bot)return;var command=message.content.split(" ")[0].slice(_this.prefix.length);var _iterator=_createForOfIteratorHelper(_this.commands),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var executable=_step.value;if(executable.name==command){executable.execute(_this.bot,message);return;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}});this.bot.login(token);}},{key:"updateData",value:function updateData(){this.config=(0,_INIParser.parse)(configFilePath);this.settings=this.config.getSection("settings");if(!this.settings){throw new Error("config file needs section 'settings'.");}this.commands=[];if(this.config.hasSection("commands"))this.commands=(0,_Executable.loadExecutables)(this.config.getSection("commands"));var tmpPrefix=this.config.getItem("prefix",this.settings);if(tmpPrefix)this.prefix=tmpPrefix;else console.warn("Warn: using '!' as prefix because no prefix was found in section 'settings'.");}}]);return Program;}();exports.Program=Program;_defineProperty(Program,"prefix","!");process.on("message",function(m){if(m==="start")Program.main();else if(m==="update")Program.updateData();});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb25maWdGaWxlUGF0aCIsImpvaW5QYXRoIiwiX19kaXJuYW1lIiwiUHJvZ3JhbSIsInVwZGF0ZURhdGEiLCJ0b2tlbiIsImNvbmZpZyIsImdldEl0ZW0iLCJzZXR0aW5ncyIsIkVycm9yIiwiYm90IiwiQ2xpZW50IiwiaW50ZW50cyIsIm9uIiwiY29uc29sZSIsImxvZyIsIkRhdGUiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJtZXNzYWdlIiwiY29udGVudCIsInRyaW1TdGFydCIsInRyaW1FbmQiLCJzdGFydHNXaXRoIiwicHJlZml4IiwiYXV0aG9yIiwiY29tbWFuZCIsInNwbGl0Iiwic2xpY2UiLCJsZW5ndGgiLCJjb21tYW5kcyIsImV4ZWN1dGFibGUiLCJuYW1lIiwiZXhlY3V0ZSIsImxvZ2luIiwicGFyc2VJTkkiLCJnZXRTZWN0aW9uIiwiaGFzU2VjdGlvbiIsImxvYWRFeGVjdXRhYmxlcyIsInRtcFByZWZpeCIsIndhcm4iLCJwcm9jZXNzIiwibSIsIm1haW4iXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFja2FnZXMvbWFpbi9Qcm9ncmFtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElOSUZpbGUsIHBhcnNlIGFzIHBhcnNlSU5JLCBTZWN0aW9uIH0gZnJvbSBcIi4vSU5JUGFyc2VyXCI7XG5pbXBvcnQgeyBqb2luIGFzIGpvaW5QYXRoIH0gZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IEFwcGxpY2F0aW9uQ29tbWFuZFR5cGUsIENsaWVudCB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XG5pbXBvcnQgeyBFeGVjdXRhYmxlLCBsb2FkRXhlY3V0YWJsZXMgfSBmcm9tIFwiLi9FeGVjdXRhYmxlXCI7XG5cbmNvbnN0IGNvbmZpZ0ZpbGVQYXRoID0gam9pblBhdGgoX19kaXJuYW1lLCBcIi4uLy4uLy4uL25hdHJpeS5jZmdcIik7XG5cbmV4cG9ydCBjbGFzcyBQcm9ncmFtIHtcblx0c3RhdGljIGJvdDogQ2xpZW50O1xuXHRzdGF0aWMgY29uZmlnOiBJTklGaWxlO1xuXHRzdGF0aWMgY29tbWFuZHM6IEV4ZWN1dGFibGVbXTtcblxuXHRzdGF0aWMgc2V0dGluZ3M6IFNlY3Rpb24gfCB1bmRlZmluZWQ7XG5cdHN0YXRpYyBwcmVmaXggPSBcIiFcIjtcblxuXHRzdGF0aWMgbWFpbigpOiB2b2lkIHtcblx0XHR0aGlzLnVwZGF0ZURhdGEoKTtcblxuXHRcdGNvbnN0IHRva2VuID0gdGhpcy5jb25maWcuZ2V0SXRlbShcInRva2VuXCIsIHRoaXMuc2V0dGluZ3MpO1xuXHRcdGlmICghdG9rZW4pIHRocm93IG5ldyBFcnJvcihcIm5vIHRva2VuIGZvdW5kIGluIHNlY3Rpb24gJ3NldHRpbmdzJy5cIik7XG5cblx0XHR0aGlzLmJvdCA9IG5ldyBDbGllbnQoe1xuXHRcdFx0aW50ZW50czogW1xuXHRcdFx0XHRcIkd1aWxkc1wiLFxuXHRcdFx0XHRcIkd1aWxkTWVzc2FnZXNcIixcblx0XHRcdFx0XCJHdWlsZE1lbWJlcnNcIixcblx0XHRcdFx0XCJHdWlsZEJhbnNcIixcblx0XHRcdFx0XCJNZXNzYWdlQ29udGVudFwiLFxuXHRcdFx0XSxcblx0XHR9KTtcblxuXHRcdHRoaXMuYm90Lm9uKFwicmVhZHlcIiwgKCkgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coYEJvdCBpcyByZWFkeSEgLSAke25ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCl9YCk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmJvdC5vbihcIm1lc3NhZ2VDcmVhdGVcIiwgKG1lc3NhZ2UpID0+IHtcblx0XHRcdG1lc3NhZ2UuY29udGVudCA9IG1lc3NhZ2UuY29udGVudC50cmltU3RhcnQoKS50cmltRW5kKCk7XG5cblx0XHRcdGlmICghbWVzc2FnZS5jb250ZW50LnN0YXJ0c1dpdGgodGhpcy5wcmVmaXgpIHx8IG1lc3NhZ2UuYXV0aG9yLmJvdClcblx0XHRcdFx0cmV0dXJuO1xuXG5cdFx0XHRjb25zdCBjb21tYW5kID0gbWVzc2FnZS5jb250ZW50LnNwbGl0KFwiIFwiKVswXS5zbGljZSh0aGlzLnByZWZpeC5sZW5ndGgpO1xuXG5cdFx0XHRmb3IgKGNvbnN0IGV4ZWN1dGFibGUgb2YgdGhpcy5jb21tYW5kcykge1xuXHRcdFx0XHRpZiAoZXhlY3V0YWJsZS5uYW1lID09IGNvbW1hbmQpIHtcblx0XHRcdFx0XHRleGVjdXRhYmxlLmV4ZWN1dGUodGhpcy5ib3QsIG1lc3NhZ2UpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gdGhpcy5ib3Qub24oXCJpbnRlcmFjdGlvbkNyZWF0ZVwiLCAoaW50ZXJhY3Rpb24pID0+IHtcblx0XHQvLyBcdGlmICghaW50ZXJhY3Rpb24uaXNDb21tYW5kKCkpIHJldHVybjtcblx0XHQvLyBcdGlmIChpbnRlcmFjdGlvbi5jb21tYW5kVHlwZSAhPSBBcHBsaWNhdGlvbkNvbW1hbmRUeXBlLkNoYXRJbnB1dCkgcmV0dXJuO1xuXG5cdFx0Ly8gXHRjb25zdCBjb21tYW5kID0gaW50ZXJhY3Rpb24uY29tbWFuZE5hbWU7XG5cblx0XHQvLyBcdGZvciAoY29uc3QgZXhlY3V0YWJsZSBvZiB0aGlzLmNvbW1hbmRzKSB7XG5cdFx0Ly8gXHRcdGlmIChleGVjdXRhYmxlLm5hbWUgPT0gY29tbWFuZCkge1xuXHRcdC8vIFx0XHRcdGV4ZWN1dGFibGUuZXhlY3V0ZSh0aGlzLmJvdCk7XG5cdFx0Ly8gXHRcdFx0cmV0dXJuO1xuXHRcdC8vIFx0XHR9XG5cdFx0Ly8gXHR9XG5cdFx0Ly8gfSk7XG5cblx0XHR0aGlzLmJvdC5sb2dpbih0b2tlbik7XG5cdH1cblxuXHRzdGF0aWMgdXBkYXRlRGF0YSgpOiB2b2lkIHtcblx0XHR0aGlzLmNvbmZpZyA9IHBhcnNlSU5JKGNvbmZpZ0ZpbGVQYXRoKTtcblxuXHRcdHRoaXMuc2V0dGluZ3MgPSB0aGlzLmNvbmZpZy5nZXRTZWN0aW9uKFwic2V0dGluZ3NcIik7XG5cdFx0aWYgKCF0aGlzLnNldHRpbmdzKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJjb25maWcgZmlsZSBuZWVkcyBzZWN0aW9uICdzZXR0aW5ncycuXCIpO1xuXHRcdH1cblxuXHRcdHRoaXMuY29tbWFuZHMgPSBbXTtcblx0XHRpZiAodGhpcy5jb25maWcuaGFzU2VjdGlvbihcImNvbW1hbmRzXCIpKVxuXHRcdFx0dGhpcy5jb21tYW5kcyA9IGxvYWRFeGVjdXRhYmxlcyhcblx0XHRcdFx0PFNlY3Rpb24+dGhpcy5jb25maWcuZ2V0U2VjdGlvbihcImNvbW1hbmRzXCIpXG5cdFx0XHQpO1xuXG5cdFx0Y29uc3QgdG1wUHJlZml4ID0gdGhpcy5jb25maWcuZ2V0SXRlbShcInByZWZpeFwiLCB0aGlzLnNldHRpbmdzKTtcblx0XHRcblx0XHRpZiAodG1wUHJlZml4KSB0aGlzLnByZWZpeCA9IHRtcFByZWZpeDtcblx0XHRlbHNlIGNvbnNvbGUud2Fybihcblx0XHRcdFx0XCJXYXJuOiB1c2luZyAnIScgYXMgcHJlZml4IGJlY2F1c2Ugbm8gcHJlZml4IHdhcyBmb3VuZCBpbiBzZWN0aW9uICdzZXR0aW5ncycuXCJcblx0XHRcdCk7XG5cdH1cbn1cblxucHJvY2Vzcy5vbihcIm1lc3NhZ2VcIiwgKG06IFwic3RhcnRcIiB8IFwidXBkYXRlXCIpID0+IHtcblx0aWYgKG0gPT09IFwic3RhcnRcIikgUHJvZ3JhbS5tYWluKCk7XG5cdGVsc2UgaWYgKG0gPT09IFwidXBkYXRlXCIpIFByb2dyYW0udXBkYXRlRGF0YSgpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI2RkFBQSxzQ0FDQSwwQkFDQSxtQ0FDQSx3Q0FBMkQsaS9GQUUzRCxHQUFNQSxlQUFjLENBQUcsR0FBQUMsVUFBUSxFQUFDQyxTQUFTLENBQUUscUJBQXFCLENBQUMsQ0FBQyxHQUVyREMsUUFBTywyR0FRbkIsZUFBb0IsZ0JBQ25CLElBQUksQ0FBQ0MsVUFBVSxFQUFFLENBRWpCLEdBQU1DLE1BQUssQ0FBRyxJQUFJLENBQUNDLE1BQU0sQ0FBQ0MsT0FBTyxDQUFDLE9BQU8sQ0FBRSxJQUFJLENBQUNDLFFBQVEsQ0FBQyxDQUN6RCxH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