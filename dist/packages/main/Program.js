"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Program=void 0;var _INIParser=require("./INIParser");var _path=require("path");var _discord=require("discord.js");var _Executable=require("./Executable");function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}var configFilePath=(0,_path.join)(__dirname,"../../../natriy.cfg");var Program=function(){function Program(){_classCallCheck(this,Program);}_createClass(Program,null,[{key:"main",value:function main(){var _this=this;this.updateData();var token=this.config.getItem("token",this.settings);if(!token)throw new Error("no token found in section 'settings'.");this.bot=new _discord.Client({intents:["Guilds","GuildMessages","GuildMembers","GuildBans","MessageContent"]});this.bot.on("ready",function(){console.log("Bot is ready! - ".concat(new Date().toLocaleTimeString()));});this.bot.on("messageCreate",function(message){message.content=message.content.trimStart().trimEnd();if(!message.content.startsWith(_this.prefix)||message.author.bot)return;var command=message.content.split(" ")[0].slice(_this.prefix.length);var _iterator=_createForOfIteratorHelper(_this.commands),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var executable=_step.value;if(executable.name==command){executable.execute(_this.bot,message);return;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}});this.bot.login(token);}},{key:"updateData",value:function updateData(){this.config=(0,_INIParser.parse)(configFilePath);this.settings=this.config.getSection("settings");if(!this.settings){throw new Error("config file needs section 'settings'.");}this.commands=[];if(this.config.hasSection("commands"))this.commands=(0,_Executable.loadExecutables)(this.config.getSection("commands"));var tmpPrefix=this.config.getItem("prefix",this.settings);if(tmpPrefix)this.prefix=tmpPrefix;else console.warn("Warn: using '!' as prefix because no prefix was found in section 'settings'.");}}]);return Program;}();exports.Program=Program;_defineProperty(Program,"prefix","!");process.on("message",function(m){if(m==="start")Program.main();else if(m==="update")Program.updateData();});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb25maWdGaWxlUGF0aCIsImpvaW5QYXRoIiwiX19kaXJuYW1lIiwiUHJvZ3JhbSIsInVwZGF0ZURhdGEiLCJ0b2tlbiIsImNvbmZpZyIsImdldEl0ZW0iLCJzZXR0aW5ncyIsIkVycm9yIiwiYm90IiwiQ2xpZW50IiwiaW50ZW50cyIsIm9uIiwiY29uc29sZSIsImxvZyIsIkRhdGUiLCJ0b0xvY2FsZVRpbWVTdHJpbmciLCJtZXNzYWdlIiwiY29udGVudCIsInRyaW1TdGFydCIsInRyaW1FbmQiLCJzdGFydHNXaXRoIiwicHJlZml4IiwiYXV0aG9yIiwiY29tbWFuZCIsInNwbGl0Iiwic2xpY2UiLCJsZW5ndGgiLCJjb21tYW5kcyIsImV4ZWN1dGFibGUiLCJuYW1lIiwiZXhlY3V0ZSIsImxvZ2luIiwiSU5JUGFyc2UiLCJnZXRTZWN0aW9uIiwiaGFzU2VjdGlvbiIsImxvYWRFeGVjdXRhYmxlcyIsInRtcFByZWZpeCIsIndhcm4iLCJwcm9jZXNzIiwibSIsIm1haW4iXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFja2FnZXMvbWFpbi9Qcm9ncmFtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElOSUZpbGUsIHBhcnNlIGFzIElOSVBhcnNlLCBTZWN0aW9uIH0gZnJvbSBcIi4vSU5JUGFyc2VyXCI7XG5pbXBvcnQgeyBqb2luIGFzIGpvaW5QYXRoIH0gZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IENsaWVudCB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XG5pbXBvcnQgeyBFeGVjdXRhYmxlLCBsb2FkRXhlY3V0YWJsZXMgfSBmcm9tIFwiLi9FeGVjdXRhYmxlXCI7XG5cbmNvbnN0IGNvbmZpZ0ZpbGVQYXRoID0gam9pblBhdGgoX19kaXJuYW1lLCBcIi4uLy4uLy4uL25hdHJpeS5jZmdcIik7XG5cbmV4cG9ydCBjbGFzcyBQcm9ncmFtIHtcblx0c3RhdGljIGJvdDogQ2xpZW50O1xuXHRzdGF0aWMgY29uZmlnOiBJTklGaWxlO1xuXHRzdGF0aWMgY29tbWFuZHM6IEV4ZWN1dGFibGVbXTtcblxuXHRzdGF0aWMgc2V0dGluZ3M6IFNlY3Rpb24gfCB1bmRlZmluZWQ7XG5cdHN0YXRpYyBwcmVmaXggPSBcIiFcIjtcblxuXHRzdGF0aWMgbWFpbigpOiB2b2lkIHtcblx0XHR0aGlzLnVwZGF0ZURhdGEoKTtcblxuXHRcdGNvbnN0IHRva2VuID0gdGhpcy5jb25maWcuZ2V0SXRlbShcInRva2VuXCIsIHRoaXMuc2V0dGluZ3MpO1xuXHRcdGlmICghdG9rZW4pIHRocm93IG5ldyBFcnJvcihcIm5vIHRva2VuIGZvdW5kIGluIHNlY3Rpb24gJ3NldHRpbmdzJy5cIik7XG5cblx0XHR0aGlzLmJvdCA9IG5ldyBDbGllbnQoeyBpbnRlbnRzOiBbXCJHdWlsZHNcIiwgXCJHdWlsZE1lc3NhZ2VzXCIsIFwiR3VpbGRNZW1iZXJzXCIsIFwiR3VpbGRCYW5zXCIsIFwiTWVzc2FnZUNvbnRlbnRcIl0gfSk7XG5cblx0XHR0aGlzLmJvdC5vbihcInJlYWR5XCIsICgpID0+IHtcblx0XHRcdGNvbnNvbGUubG9nKGBCb3QgaXMgcmVhZHkhIC0gJHtuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpfWApO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5ib3Qub24oXCJtZXNzYWdlQ3JlYXRlXCIsIChtZXNzYWdlKSA9PiB7XG5cdFx0XHRtZXNzYWdlLmNvbnRlbnQgPSBtZXNzYWdlLmNvbnRlbnQudHJpbVN0YXJ0KCkudHJpbUVuZCgpO1xuXG5cdFx0XHRpZiAoIW1lc3NhZ2UuY29udGVudC5zdGFydHNXaXRoKHRoaXMucHJlZml4KSB8fCBtZXNzYWdlLmF1dGhvci5ib3QpIHJldHVybjtcblxuXHRcdFx0Y29uc3QgY29tbWFuZCA9IG1lc3NhZ2UuY29udGVudC5zcGxpdChcIiBcIilbMF0uc2xpY2UodGhpcy5wcmVmaXgubGVuZ3RoKTtcblxuXHRcdFx0Zm9yIChjb25zdCBleGVjdXRhYmxlIG9mIHRoaXMuY29tbWFuZHMpIHtcblx0XHRcdFx0aWYgKGV4ZWN1dGFibGUubmFtZSA9PSBjb21tYW5kKSB7XG5cdFx0XHRcdFx0ZXhlY3V0YWJsZS5leGVjdXRlKHRoaXMuYm90LCBtZXNzYWdlKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHRoaXMuYm90LmxvZ2luKHRva2VuKTtcblx0fVxuXG5cdHN0YXRpYyB1cGRhdGVEYXRhKCk6IHZvaWQge1xuXHRcdHRoaXMuY29uZmlnID0gSU5JUGFyc2UoY29uZmlnRmlsZVBhdGgpO1xuXG5cdFx0dGhpcy5zZXR0aW5ncyA9IHRoaXMuY29uZmlnLmdldFNlY3Rpb24oXCJzZXR0aW5nc1wiKTtcblx0XHRpZiAoIXRoaXMuc2V0dGluZ3MpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihcImNvbmZpZyBmaWxlIG5lZWRzIHNlY3Rpb24gJ3NldHRpbmdzJy5cIik7XG5cdFx0fVxuXG5cdFx0dGhpcy5jb21tYW5kcyA9IFtdO1xuXHRcdGlmICh0aGlzLmNvbmZpZy5oYXNTZWN0aW9uKFwiY29tbWFuZHNcIikpIHRoaXMuY29tbWFuZHMgPSBsb2FkRXhlY3V0YWJsZXMoPFNlY3Rpb24+dGhpcy5jb25maWcuZ2V0U2VjdGlvbihcImNvbW1hbmRzXCIpKTtcblxuXHRcdGNvbnN0IHRtcFByZWZpeCA9IHRoaXMuY29uZmlnLmdldEl0ZW0oXCJwcmVmaXhcIiwgdGhpcy5zZXR0aW5ncyk7XG5cdFx0aWYgKHRtcFByZWZpeCkgdGhpcy5wcmVmaXggPSB0bXBQcmVmaXg7XG5cdFx0ZWxzZSBjb25zb2xlLndhcm4oXCJXYXJuOiB1c2luZyAnIScgYXMgcHJlZml4IGJlY2F1c2Ugbm8gcHJlZml4IHdhcyBmb3VuZCBpbiBzZWN0aW9uICdzZXR0aW5ncycuXCIpO1xuXHR9XG59XG5cbnByb2Nlc3Mub24oXCJtZXNzYWdlXCIsIChtOiBcInN0YXJ0XCIgfCBcInVwZGF0ZVwiKSA9PiB7XG5cdGlmIChtID09PSBcInN0YXJ0XCIpIFByb2dyYW0ubWFpbigpO1xuXHRlbHNlIGlmIChtID09PSBc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